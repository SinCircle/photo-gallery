<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Minimal Thumbnail Test</title>
    <style>
        body { font-family: system-ui; padding: 20px; background: #f4f4f4; }
        .tile { margin: 20px 0; padding: 20px; background: white; border-radius: 12px; }
        img { max-width: 400px; display: block; }
        .status { padding: 10px; margin: 10px 0; border-radius: 6px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Minimal Thumbnail Loading Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = msg;
            results.appendChild(div);
            console.log(msg);
        }
        
        async function testThumbnailLoading() {
            try {
                // Step 1: Load manifest
                log('Step 1: Loading manifest...', 'info');
                const manifestRes = await fetch('images-manifest.json');
                if (!manifestRes.ok) throw new Error(`Manifest fetch failed: ${manifestRes.status}`);
                const manifest = await manifestRes.json();
                log(`✓ Manifest loaded: ${manifest.images.length} images`, 'success');
                
                // Step 2: Get first image
                const firstImage = manifest.images[0];
                log(`Step 2: First image - path: ${firstImage.path}, thumb: ${firstImage.thumb}`, 'info');
                
                // Step 3: Build thumbnail URL (same logic as photos.ts)
                const thumbUrl = `images/${firstImage.thumb}`;
                log(`Step 3: Thumbnail URL: ${thumbUrl}`, 'info');
                
                // Step 4: Fetch thumbnail (same logic as thumbs.ts)
                log('Step 4: Fetching thumbnail...', 'info');
                const thumbRes = await fetch(thumbUrl, { cache: 'force-cache' });
                if (!thumbRes.ok) throw new Error(`Thumbnail fetch failed: ${thumbRes.status} ${thumbRes.statusText}`);
                log(`✓ Thumbnail fetched: ${thumbRes.status} ${thumbRes.statusText}`, 'success');
                
                // Step 5: Create blob
                const blob = await thumbRes.blob();
                log(`✓ Blob created: ${blob.size} bytes, type: ${blob.type}`, 'success');
                
                // Step 6: Create object URL
                const objectUrl = URL.createObjectURL(blob);
                log(`✓ Object URL created: ${objectUrl}`, 'success');
                
                // Step 7: Load image
                log('Step 7: Loading image...', 'info');
                const tile = document.createElement('div');
                tile.className = 'tile';
                const img = document.createElement('img');
                img.src = objectUrl;
                img.alt = firstImage.path;
                
                img.onload = () => {
                    log(`✓ Image loaded: ${img.naturalWidth}x${img.naturalHeight}`, 'success');
                    tile.appendChild(img);
                    results.appendChild(tile);
                };
                
                img.onerror = (e) => {
                    log(`✗ Image failed to load: ${e}`, 'error');
                };
                
            } catch (err) {
                log(`✗ Error: ${err.message}`, 'error');
                console.error(err);
            }
        }
        
        testThumbnailLoading();
    </script>
</body>
</html>
